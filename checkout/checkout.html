<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <link rel="shortcut icon" href="../images/hackware_icon.png"
                              type="image/png"/>
    <title>Rental</title>
    <script src="../js/parse-1.3.4.min.js"></script>
    <script src="../js/jquery-2.1.3.min.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/inventory.css" />
    <link rel="stylesheet" type="text/css" href="../css/style.css" />
    <script src="../js/jstorage.min.js"></script>
    <script type="text/javascript" src="https://js.stripe.com/v2/"></script>
    <script type="text/javascript">
      var itemPrice = "Only available at hackathons.",
          itemName = $.jStorage.get("item");
      $(window).load(function() {        
        //alert("this is the checkout page, and I just got this item: " +
        //itemName);
        document.getElementById("itemname").innerHTML = itemName;
        document.getElementById("iName").value = itemName;

        //TODO parse request to get item (id, price, etc.) and to mark it as 
        //rented if successful
        Parse.initialize("PRZCDqiKSpzjNuIGTEHj9jXKn6f1PRfAixB2nK2r", 
          "GuD81fbE4prg1RdLLmJvhLdb8CBa21imyroGrMRk");    
        var Hardware = Parse.Object.extend("Hardware");
        var query = new Parse.Query(Hardware);
        query.ascending("Name");
        query.equalTo("Name", itemName);
        query.equalTo("rented", false);
        query.find({
          success: function(results) {
            // Successfully retrieved the object.
            //alert("found this item: " + results[0].get("Name"));
	    if(results[0].get("RentalPrice") == 0){
	      document.getElementById("itemprice").innerHTML = itemPrice;
	    }else{
              itemPrice = results[0].get("RentalPrice");
              document.getElementById("itemprice").innerHTML = "$"+ itemPrice;
              document.getElementById("iPrice").value = itemPrice;
            }
          },
          error: function(error) {
            alert("Error: " + error.code + " " + error.message);
          }
        });
      });
    </script>
  </head>

  <body>
    <div id="container">
      <h1>Rental Checkout</h1>
      <!-- TODO: get the name of the item clicked on previous page. use that 
        name to search the parse db for the first item that matches that name 
        that is still available for rent. get the price and set that to a var 
        to be used in -->
      <form action="/checkout" method="POST" id="payment-form">
<<<<<<< HEAD:checkout/checkout.html

=======
>>>>>>> ae1e576ddaa025eb8b4dcfdfe2e7eea1684dd3ee:hackware/checkout.html
        <h4 id="itemname"></h4>
        <input type="hidden" name="itemName" id="iName" />
        
        <h4 id="itemprice"></h4>
        <input type="hidden" name="itemPrice" id="iPrice" />

        <div class="form-row">
          <label for="name" class="stripeLabel">Your Name</label>
          <input type="text" name="name" class="required" />
        </div>            
        <div class="form-row">
          <label for="email">E-mail Address</label>
          <input type="text" name="email" class="required" />
        </div>            
        <div class="form-row">
          <label>Card Number</label>
          <input type="text" maxlength="20" autocomplete="off" 
            class="card-number stripe-sensitive required" />
        </div>
        <div class="form-row">
          <label>CVC</label>
          <input type="text" maxlength="4" autocomplete="off" 
            class="card-cvc stripe-sensitive required" />
        </div>
        <div class="form-row">
          <label>Expiration (MM/YYYY)</label>
          <div class="expiry-wrapper">
            <select class="card-expiry-month stripe-sensitive required">
            </select>

            <script type="text/javascript">
            var select = $(".card-expiry-month"),
                month = new Date().getMonth() + 1;
            for (var i = 1; i <= 12; i++) {
              select.append($("<option value='"+i+"' " +
                    (month === i ? "selected" : "")+">"+i+"</option>"));
            }
            </script>
            
            <span> / </span>
            
            <select class="card-expiry-year stripe-sensitive required"></select>
            
            <script type="text/javascript">
            var select = $(".card-expiry-year"),
                year = new Date().getFullYear();

            for (var i = 0; i < 12; i++) {
              select.append($("<option value='"+(i + year)+"' " +
                    (i === 0 ? "selected" : "")+">"+(i + year)+"</option>"));
            }
            </script>
          </div>
        </div>
        <input type="submit" class="submit-button" value="Submit">
        <div class="payment-errors"></div>
      </form>
    </div>
  </body>
</html>
